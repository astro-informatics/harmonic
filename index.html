<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Harmonic &mdash; Harmonic 1.0.3 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom_tabs.css" type="text/css" />
      <link rel="stylesheet" href="_static/dark_mode_css/general.css" type="text/css" />
      <link rel="stylesheet" href="_static/dark_mode_css/dark.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="_static/dark_mode_js/default_light.js"></script>
        <script src="_static/dark_mode_js/theme_switcher.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installation" href="user_guide/install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="#">
            <img src="_static/harm_badge_simple.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.0.3
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="user_guide/install.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Background</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="background/Harmonic_Estimator/original_harmonic_mean.html">Harmonic mean estimator</a></li>
<li class="toctree-l1"><a class="reference internal" href="background/Harmonic_Estimator/retargetd_harmonic_mean.html">Re-targeted harmonic mean estimator</a></li>
<li class="toctree-l1"><a class="reference internal" href="background/Harmonic_Estimator/learnt_harmonic_mean.html">Learnt harmonic mean estimator</a></li>
<li class="toctree-l1"><a class="reference internal" href="background/Machine_Learning/index.html">Learning a suitable target distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="background/Bayes_Factors/bayes_factors.html">Bayes factors</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorials/basic_usage.html">Basic usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/cross-validation_hyper-parameters.html">Hyper-parameter cross-validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/cross-validation_learnt_model.html">Model cross-validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/checkpointing.html">Checkpointing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">Namespaces</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">Harmonic</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
      <li>Harmonic</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<p><a class="reference external" href="https://github.com/astro-informatics/harmonic"><img alt="GitHub" src="https://img.shields.io/badge/GitHub-harmonic-brightgreen.svg?style=flat" /></a> <a class="reference external" href="https://github.com/astro-informatics/harmonic/actions/workflows/python.yml"><img alt="Build Status" src="https://github.com/astro-informatics/harmonic/actions/workflows/python.yml/badge.svg" /></a> <a class="reference external" href="https://astro-informatics.github.io/harmonic/"><img alt="Docs" src="https://readthedocs.org/projects/ansicolortags/badge/?version=latest" /></a> <a class="reference external" href="https://codecov.io/gh/astro-informatics/harmonic"><img alt="CodeCov" src="https://codecov.io/gh/astro-informatics/harmonic/branch/main/graph/badge.svg?token=1s4SATphHV" /></a> <a class="reference external" href="https://badge.fury.io/py/harmonic"><img alt="PyPI" src="https://badge.fury.io/py/harmonic.svg" /></a> <a class="reference external" href="http://perso.crans.org/besson/LICENSE.html"><img alt="GPL license" src="https://img.shields.io/badge/License-GPL-blue.svg" /></a> <a class="reference external" href="https://arxiv.org/abs/2111.12720"><img alt="ArXiv" src="http://img.shields.io/badge/arXiv-2111.12720-orange.svg?style=flat" /></a></p>
<div class="section" id="harmonic">
<h1>Harmonic<a class="headerlink" href="#harmonic" title="Permalink to this headline"></a></h1>
<p>We resurrect the infamous harmonic mean estimator for computing the marginal likelihood (Bayesian evidence) and solve its problematic large variance.  The marginal likelihood is a key component of Bayesian model selection since it is required to evaluate model posterior probabilities;  however, its computation is challenging.  The original harmonic mean estimator, first proposed in 1994 by Newton and Raftery, involves computing the harmonic mean of the likelihood given samples from the posterior.  It was immediately realised that the original estimator can fail catastrophically since its variance can become very large and may not be finite.  A number of variants of the harmonic mean estimator have been proposed to address this issue although none have proven fully satisfactory.</p>
<p>We present the <em>learnt harmonic mean estimator</em>, a variant of the original estimator that solves its large variance problem.  This is achieved by interpreting the harmonic mean estimator as importance sampling and introducing a new target distribution.  The new target distribution is learned to approximate the optimal but inaccessible target, while minimising the variance of the resulting estimator.  Since the estimator requires samples of the posterior only it is agnostic to the strategy used to generate posterior samples.</p>
<p>For an accessible overview of the <em>learnt harmonic mean estimator</em> please see this <a class="reference external" href="https://towardsdatascience.com/learnt-harmonic-mean-estimator-for-bayesian-model-selection-47258bb0fc2e">Towards Data Science article</a>.</p>
<div class="section" id="overview-video">
<h2>Overview video<a class="headerlink" href="#overview-video" title="Permalink to this headline"></a></h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/RHoQItSA4J4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<div class="section" id="how-to-use-this-guide">
<h2>How to use this guide<a class="headerlink" href="#how-to-use-this-guide" title="Permalink to this headline"></a></h2>
<p>To get started, follow the <a class="reference internal" href="user_guide/install.html#installation"><span class="std std-ref">installation guide</span></a>.  For a brief background of the <em>learnt harmonic mean estimator</em>  please see the <span class="xref std std-ref">background</span> section of this guide, which provides sufficient background to inform the practioner.  For further background details please see the related paper (<a class="reference external" href="https://arxiv.org/abs/2111.12720">McEwen et al. 2021</a>).  We have also provided <a class="reference internal" href="tutorials/index.html#jupyter-notebooks"><span class="std std-ref">tutorials</span></a>, comprised of a number of interactive notebooks that provide a step-by-step guide to get <strong>harmonic</strong> up and running for your particular application.  An up-to-date catalog of the software functionality can be found on the <a class="reference internal" href="api/index.html#namespaces"><span class="std std-ref">API</span></a> page.</p>
</div>
<div class="section" id="basic-usage">
<h2>Basic usage<a class="headerlink" href="#basic-usage" title="Permalink to this headline"></a></h2>
<p>First you will want to install <strong>harmonic</strong>, which is as simple as running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install harmonic
</pre></div>
</div>
<p>Now, suppose you have collected many posterior samples, perhaps drawn using <a class="reference external" href="https://emcee.readthedocs.io/en/stable/">emcee</a> or another sampler, and <em>a posteriori</em> wish to compute the evidence, you would do something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">harmonic</span> <span class="k">as</span> <span class="nn">hm</span>

<span class="c1"># Instantiate harmonic&#39;s chains class</span>
<span class="n">chains</span> <span class="o">=</span> <span class="n">hm</span><span class="o">.</span><span class="n">Chains</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">chains</span><span class="o">.</span><span class="n">add_chains_3d</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">lnprob</span><span class="p">)</span>

<span class="c1"># Split the chains into the ones which will be used to train the machine learning model and for inference</span>
<span class="n">chains_train</span><span class="p">,</span> <span class="n">chains_infer</span> <span class="o">=</span> <span class="n">hm</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">split_data</span><span class="p">(</span><span class="n">chains</span><span class="p">,</span> <span class="n">training_proportion</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Select a machine learning model and train it</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">hm</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="p">[</span><span class="n">select</span> <span class="n">a</span> <span class="n">model</span><span class="p">](</span><span class="n">model</span> <span class="n">hyper</span><span class="o">-</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">fit_success</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">chains_train</span><span class="o">.</span><span class="n">samples</span><span class="p">,</span> <span class="n">chains_train</span><span class="o">.</span><span class="n">ln_posterior</span><span class="p">)</span>

<span class="c1"># Instantiate harmonic&#39;s evidence class</span>
<span class="n">ev</span> <span class="o">=</span> <span class="n">hm</span><span class="o">.</span><span class="n">Evidence</span><span class="p">(</span><span class="n">chains_infer</span><span class="o">.</span><span class="n">nchains</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

<span class="c1"># Pass the evidence class the inference chains and compute the evidence!</span>
<span class="n">ev</span><span class="o">.</span><span class="n">add_chains</span><span class="p">(</span><span class="n">chains_infer</span><span class="p">)</span>
<span class="n">evidence</span><span class="p">,</span> <span class="n">evidence_std</span> <span class="o">=</span> <span class="n">ev</span><span class="o">.</span><span class="n">compute_evidence</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A variety of bespoke machine learning models are already supported, and the user is free to overload this functionality with their own models.</p>
</div>
</div>
<div class="section" id="referencing">
<h2>Referencing<a class="headerlink" href="#referencing" title="Permalink to this headline"></a></h2>
<p id="id1"><ul class="simple">
<li id="id2"><p>Jason D. McEwen, Christopher G. R. Wallis, Matthew A. Price, and Matthew M. Docherty. Machine learning assisted Bayesian model comparison: learnt harmonic mean estimator. <em>ArXiv</em>, 2021. <a class="reference external" href="https://arxiv.org/abs/2111.12720">arXiv:2111.12720</a>.</p></li>
</ul>
</p>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
<div class="toctree-wrapper compound">
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="user_guide/install.html" class="btn btn-neutral float-right" title="Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Jason D. McEwen, Christopher G. R. Wallis, Matthew A. Price, Matthew M. Docherty.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>