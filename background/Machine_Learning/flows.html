<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; Harmonic 1.2.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/custom_tabs.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/dark_mode_css/general.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/dark_mode_css/dark.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script src="../../_static/dark_mode_js/default_light.js"></script>
        <script src="../../_static/dark_mode_js/theme_switcher.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html">
            <img src="../../_static/harm_badge_simple.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_guide/install.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Background</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Harmonic_Estimator/original_harmonic_mean.html">Harmonic mean estimator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Harmonic_Estimator/retargetd_harmonic_mean.html">Re-targeted harmonic mean estimator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Harmonic_Estimator/learnt_harmonic_mean.html">Learnt harmonic mean estimator</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Learning a suitable target distribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Bayes_Factors/bayes_factors.html">Bayes factors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Log_space_statistics/log_variance.html">Log-space variance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/basic_usage.html">Basic Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/checkpointing.html">Checkpointing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Namespaces</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Harmonic</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/background/Machine_Learning/flows.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>Normalizing flows are a class of probabilistic models that allow one to evaluate the density of and sample from a learned probability distribution (for a review see <a class="reference external" href="https://arxiv.org/abs/1912.02762">(Papamakarios et al., 2021)</a>). They consist of a series of transformations that are applied to a simple base distribution.  A vector <span class="math notranslate nohighlight">\(\theta\)</span>
of an unknown distribution <span class="math notranslate nohighlight">\(p(\theta)\)</span>, can be expressed through a transformation <span class="math notranslate nohighlight">\(T\)</span> of a vector <span class="math notranslate nohighlight">\(z\)</span> sampled from a base distribution <span class="math notranslate nohighlight">\(q(z)\)</span>:</p>
<div class="math notranslate nohighlight">
\[\theta = T(z), \text{ where } z \sim q(z).\]</div>
<p>Typically the base distribution is chosen so that its density can be evaluated simply and that it can be sampled from easily. Often a Gaussian is used for the base distribution.
The unknown distribution can then be recovered by the change of variables formula:</p>
<div class="math notranslate nohighlight">
\[p(\theta) = q(z) \vert \det J_{T}(z)  \vert^{-1},\]</div>
<p>where <span class="math notranslate nohighlight">\(J_{T}(z)\)</span> is the Jacobian corresponding to transformation <span class="math notranslate nohighlight">\(T\)</span>. In a flow-based model <span class="math notranslate nohighlight">\(T\)</span> consists of a series of learned transformations that are each invertible and differentiable, so that the full transformation is also invertible and differentiable.  This allows us to compose multiple simple transformations with learned parameters, into what is called a flow, obtaining a normalized approximation of the unknown distribution that we can sample from and evaluate.  Careful attention is given to construction of the transformations such that the determinant of the Jacobian can be computed easily.</p>
<p><strong>Real NVP Flows</strong></p>
<p>A relatively simple example of a normalizing flow is the real-valued non-volume preserving (real NVP) flow introduced in <a class="reference external" href="https://arxiv.org/abs/1605.08803">(Dinh et al., 2016)</a>.
It consists of a series of bijective transformations given by affine coupling layers. Consider the <span class="math notranslate nohighlight">\(D\)</span> dimensional input <span class="math notranslate nohighlight">\(z\)</span>, split into elements up to and following <span class="math notranslate nohighlight">\(d\)</span>, respectively, <span class="math notranslate nohighlight">\(z_{1:d}\)</span> and <span class="math notranslate nohighlight">\(z_{d+1:D}\)</span>, for <span class="math notranslate nohighlight">\(d&lt;D\)</span>.  Given input <span class="math notranslate nohighlight">\(z\)</span>, the output <span class="math notranslate nohighlight">\(y\)</span> of an affine couple layer is calculated by</p>
<div class="math notranslate nohighlight">
\[\begin{split}y_{1:d} =   &amp; z_{1:d} ;                                                 \\
y_{d+1:D} = &amp; z_{d+1:D} \odot \exp\bigl(s(z_{1:d})\bigr) +  t(z_{1:d}),\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\odot\)</span> denotes Hadamard (elementwise) multiplication.
The scale <span class="math notranslate nohighlight">\(s\)</span> and translation <span class="math notranslate nohighlight">\(t\)</span> are typically represented by neural networks with learnable parameters that take as input <span class="math notranslate nohighlight">\(z_{1:d}\)</span>.  This construction is easily invertible and ensures the Jacobian is a lower-triangular matrix, making its determinant efficient to calculate.</p>
<p><strong>Rational Quadratic Spline Flows</strong></p>
<p>A more complex and expressive class of flows are rational quadratic spline flows described in detail in <a class="reference external" href="https://arxiv.org/abs/1906.04032">(Durkan et al., 2019)</a>. The architecture is similar to Real NVP flows, but the layers include monotonic splines. These are piecewise functions consisting of multiple segments of monotonic rational-quadratics with learned parameters. Such layers are combined with alternating affine transformations to create the normalizing flow. Rational quadratic spline flows are well-suited to higher dimensional and more complex problems than real NVP flows.</p>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Jason D. McEwen, Christopher G. R. Wallis, Matthew A. Price, Matthew M. Docherty, Alicja Polanska.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>